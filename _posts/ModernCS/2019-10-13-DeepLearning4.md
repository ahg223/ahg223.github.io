---
title: "Deep Learning"
excerpt: "Batch Normalization, SGD, RMSprop, Adam, GPU"

categories:
  - ModernCS
tags:
  - ModernCS
  - DeepLearning
---

## Batch Normalization 
BN은 각 레이어의 입력전에 입력 피쳐를 z 정규화를 하고 scale, shift를 시켜 입력 피쳐들의 분포를 안정적으로 만든다. 학습 속도가 빨라지고 오버피팅 확률이 줄 어든다.

### Dropout의 효과는? 
랜덤으로 선별된 적은 노드로도 성과를 내야하기 때문에 전체 모델이 오버피 팅 되는 경향이 줄어든다.

### BN 적용해서 학습 이후 실제 사용시에 주의할 점은? 
학습시에는 mini-batch 단위의 평 균과 분산을 사용하게 되지만, 테스트시에는 미니 배치보다 적은 단위의 케이스를 다룰 수 있기 때 문에, 미리 학습 데이터에서 뽑아낸 평균과 분산을 사용해서 처리해야한다.

## SGD, RMSprop, Adam 
SGD는 미니 배치에서의 loss에 대해 기울 기를 계산해 학습하는 방식이고 RMSprop는 학습하면서 한 번에 움직이는 step size를 조정하는 방식인데 지금까지 많이 움직인 파라미터는 조금만 움직이도록 패널티를 주고, 적게 움직인 파라 미터가 더 많이 움직일 수 있도록 가중치를 주는 방식이다. Adam은 Adaptive momentum 방식으 로 step 사이즈를 조정하기도하고, 기존에 학습 방향에도 모멘텀을 주어서 전반적인 방향성에 가 중치를 주어 빠르게 미니마를 찾도록 한다.  

### SGD에서 Stochastic의 의미는? 
GD가 한 번 움직일때마다 모든 학습 데이터셋을 사용한다면 SGD 는 그 중 학습 데이터셋의 일부만 사용해서 움직입니다. Stocahstic은 어떤 샘플을 고를지가 확률 적으로 정해진다는 의미입니다.

### 미니배치를 작게 할때의 장단점은? 
gradient 계산 속도가 빨라지는 게 장점이고, 특정 데이터셋에 편향되어 움직일 수 있다는게 단점입니다.


## 딥러닝과 GPU 
GPU는 Matrix x Matrix, Matrix x vector 연산을 위한 최적의 기계이다. CUDA를 사용해서 매트릭스를 GPU에서 한 번에 연산할 수 있는 사이즈로 타일링을 시켜주면 GPU는 병렬적으로 1 사이클에 메모리에 올릴 수 있는 최대 연산을 할 수 있게된다. 또한 딥러닝 네트워크에는 웨이트가 0인 값이 상당히 많아지게 되는데, DMA, 제로 스키핑 기술과 같은 기술을 사용해서 연산 속도를 빠르게 할 수 있다. 따라서 CPU로 연산하는 것보다 훨씬 빠르다.

### 학습 중인데 GPU를 100% 사용하지 않고 있다. 이유는? 
미니 배치 단위가 너무 작기 때문이다. 

### GPU를 두개 다 쓰고 싶다. 방법은? 
케라스에서는 그냥 멀티 지피유 코드를 사용하면 되지만, 텐서 플로에서는 네트웍을 나누어 각 GPU에 올려야한다. 만약 텐서플로에서 한 네트워크를 여러개의 GPU를 사용해서 처리속도를 높이고 싶다면, 각각의 GPU에 같은 모델을 올린 후에 서로 다른 미니 배치를 처리하고, 값을 평균내 학습을 시킨다던가 하는 기술이 필요하다.

### 학습시 필요한 GPU 메모리는 어떻게 계산하는가? 
첫째로 네트워크 사이즈를 체크해야 한다. 케라스 같은 경우에는 모델 서머리를 사용해서 전체 네트워크를 체크할 수 있고, 텐서플로도 비슷한 방법으로 네트워크 사이즈를 체크할 수 있다. 주의해야 할 점은, AdamOptimizer를 사용할 경우 필요한 네트웤 사이즈가 두 배가 된다. 둘 째로 미니 배치 단위의 메모리를 체크해야한다. 이 경우 한 번에 GPU 메모리에 올라가는 미니 배치의 입력 크기를 계산해 보면 된다.

## 디버깅 노하우 

TF를 사용할 때 tf.summary.scalar를 사용해 loss 나 validation accuracy값을 저장할 수 있고, tf.train.summarywriter를 사용해 텐서보드에서 값들 을 디버깅할 수 있다. 그리고 텐서보드에서 graph를 살펴보면서, 레이어들의 연결관계와 optimizer와 제대로 연결되어 있는지를 살펴볼 수 있다.
