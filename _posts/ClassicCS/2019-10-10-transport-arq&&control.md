---
title : OSI 7 - Transport Layer
excerpt : Detail - TCP, UDP

categories:
  - ClassicCS
tags:
  - ClassicCS
  - Network
---  

## 전송 계층(Transport Layer)

OSI 7 Layer에서 4 계층에 해당된다.  

계층 구조의 네트워크 구성요소와 프로토콜 내에서 송신자와 수신자를 연결하는 통신 서비스를 제공한다. 전송 계층은 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어, 다중화를 제공한다.  

전송 프로토콜 중 가장 잘 알려진 것은 연결 지향 전송 방식을 사용하는 전송 제어 프로토콜 (TCP)이며, 보다 단순한 전송에 사용되는 사용자 데이터그램 프로토콜 (UDP)도 있다.

### 주요 기능 및 특징

* 네트워크가 아닌 호스트 내에 구동된 프로세스 사이의 연결 확립 (End-to-End)
* 트랜스포트 계층은 정보전달을 두 호스트(host-to-host)간 보다는, 주로 프로세스 간 (process-to-process)의 통신으로 바꾸어 줌
* Session - Transport - Network layer의 제어방법이나 내용이 달라져도 내용이 바뀜없이 투명(Transparent)하게 전송
* 세션(Session)을 갖고 있는 두 이용자 사이의 전송을 위한 종단 간 제어
* 어떤 망(공중망: PSTN, 패킷공중데이타망: PSDN등) 이 어떻게 연결되었든 정보를 상대에게 전달

## TCP vs UDP

![스크린샷 2019-10-08 오후 6 21 56](https://user-images.githubusercontent.com/44635266/66383761-87bd4480-e9f8-11e9-8b73-75b677ff6c56.png)

## TCP (전송 제어 프로토콜, Transmission Control Protocol) 

TCP는 IP의 핵심 프로토콜 중 하나로, IP와 함께 TCP/IP라는 명칭으로도 널리 불린다. TCP는 근거리 통신망이나 인트라넷, 인터넷에 연결된 컴퓨터에서 실행되는 프로그램 간의 세그먼트를 안정적으로, 순서대로, 에러없이 교환할 수 있게 한다. TCP는 전송 계층에 위치한다. 네트워크의 정보 전달을 통제하는 프로토콜이자 인터넷을 이루는 핵심 프로토콜의 하나로서 국제 인터넷 표준화 기구(IETF)의 RFC 793에 기술되어 있다.

TCP 는 데이터의 정확성 확인하고, 패킷을 목적지까지의 전송은 IP가 담당을 한다. 그래서 송-수신자 모두 `tcp reassembly`을 진행한다. 즉, TCP 프로토콜에서도 패킷은 순서가 바껴서 도착할 수 있다. 하지만 tcp reassembly를 통해 신뢰성을 확보하다.

### tcp reassembly

비신뢰적인 프로토콜을 신뢰성있게 재조립(순서, 중복 손실등 제어)

### TCP 특징
* 높은 신뢰성을 보장한다.
* 서버소켓은 연결만을 담당한다.
* 3-way handshaking과정을 통해 연결을 설정하고 4-way handshaking을 통해 해제한다.
* 전이중(Full-Duplex), 점대점(Point to Point) 방식.
* 연결과정에서 반환된 클라이언트 소켓은 데이터의 송수신에 사용된다형 서비스로 가상 회선 방식을 제공한다.
* 서버와 클라이언트는 1대1로 연결된다.
* 패킷에 대한 응답을 해야하기 때문에(시간 지연, CPU 소모) 성능이 낮다.
* 스트림 전송으로 전송 데이터의 크기가 무제한이다.
* Streaming 서비스에 불리하다.(손실된 경우 재전송 요청을 하므로)
* TCP는 통신을 할때 네트워크 트래픽에 대한 흐름제어와 혼잡제어를 한다.


### TCP Flag Bit

*URG (Urgent)*
긴급함을 알리는 용도

*ACK (Acknowledge)*
확인을 나타내는 용도

*PSH (Push)*
서버측에 전송할 데이터가 없음과, 버퍼를 모두 채우지 않고 바로 발송 하라는 용도

*RST (Reset)*
강제 연결 초기화 용도

*SYN (Synchronize)*
연결시작, 회선개설 용도

*FIN (Finish)*
연결 해제, 회선 종결 용도

### TCP Handshake Total
![image](https://user-images.githubusercontent.com/34998051/68587612-d31cb400-04ca-11ea-90f7-da51cfb754e6.png)

### TCP Three-Way Handshake

> Connection EstablishMent

![스크린샷 2019-10-08 오후 6 15 43](https://user-images.githubusercontent.com/44635266/66383278-aec74680-e9f7-11e9-88f6-c5700ba5c0b1.png)

1. 클라이언트가 서버에 SYN(j) 패킷을 보낸다.
2. 서버는 클라이언트의 요청인 SYN(j) 패킷을 받고 클라이언트에게 요청을 수락하는 ACK(j+1)과 SYN(k)를 발송한다.
3. 클라이언트가 서버의 수락 응답인 ACK(j+1)과 SYN(k) 패킷을 받고 ACK(k+1)를 서버로 보내면 연결이 성립된다.

### TCP Four-Way Handshake

> Connection Termination

![스크린샷 2019-10-08 오후 6 15 48](https://user-images.githubusercontent.com/44635266/66383280-af5fdd00-e9f7-11e9-8727-f5b2c06e15b6.png)

1. 클라이언트가 연결을 종료하겠다는 FIN 패킷을 보낸다.
2. 서버는 클라이언트의 요청을 받고 확인 메세지로 ACK를 보낸다. 그 후 데이터를 모두 보낼때 까지 잠깐 TIME OUT이 된다.
3. 데이터를 모두 보내고 통신이 끝나면 서버가 클라이언트에게 FIN 패킷을 보낸다.
4. 클라이언트는 FIN 패킷을 확인했다는 ACK를 서버에게 보낸다.
5. 클라이언트의 ACK 패킷을 받은 서버는 소켓 연결을 close한다.
6. 클라이언트는 아직 서버로부터 받지 못한 데이터가 있을 것을 대비해 일정 시간 동안 세션을 남겨놓고 잉여 패킷을 기다리는 TIME_WAIT 과정을 거친다.

## UDP (사용자 데이터그램 프로토콜, User Datagram Protocol)

UDP 전송 방식은 너무 단순해서 서비스의 신뢰성이 낮고, 데이터그램 도착 순서가 바뀌거나, 중복되거나, 심지어는 통보 없이 누락시키기도 한다. 하지만 TCP보다 속도가 빠르다. UDP는 일반적으로 오류의 검사와 수정이 필요 없는 애플리케이션에서 수행할 것으로 가정한다.

UDP를 사용하는 네트워크 애플리케이션에는 도메인 이름 서비스 (DNS), IPTV, 음성 인터넷 프로토콜 (VoIP), TFTP, IP 터널, 그리고 많은 온라인 게임 등이 있다.

### UDP 특징

* 비연결형 서비스로 데이터그램 방식을 제공한다.
* 정보를 주고 받을 때 정보를 보내거나 받는다는 신호절차를 거치지 않는다.
* UDP헤더의 CheckSum 필드를 통해 최소한의 오류만 검출한다.
* 신뢰성이 낮다
* TCP보다 속도가 빠르다
* UDP에는 연결 자체가 없어서(connect 함수 불필요) 서버 소켓과 클라이언트 소켓의 구분이 없다.
* 소켓 대신 IP를 기반으로 데이터를 전송한다.
* 서버와 클라이언트는 1대1, 1대N, N대M 등으로 연결될 수 있다.
* 데이터그램(메세지) 단위로 전송되며 그 크기는 65535바이트로, 크기가 초과하면 잘라서 보낸다.
* 흐름제어(flow control)가 없어서 패킷이 제대로 전송되었는지, 오류가 없는지 확인할 수 없다.
* 파일 전송과 같은 신뢰성이 필요한 서비스보다 성능이 중요시 되는 경우에 사용된다.

